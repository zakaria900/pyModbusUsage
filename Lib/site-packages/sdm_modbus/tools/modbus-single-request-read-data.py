import pymodbus.exceptions
import sdm_modbus
import time 
import pymodbus
import sdm_modbus.ws100

# start_ID = 1
# end_ID = 10

# for address in range(start_ID, end_ID +1):
#         device = sdm_modbus.SDM630(device="/dev/ttyUSB1",baud=9600, unit=address, parity="N")
#         print(device.connected())
#         try:
#             device.read('l1_voltage')
#             print(f'Device detected at ID {address}')
#             print("")
#             device.disconnect()
#             time.sleep(1)
#         except pymodbus.exceptions.ModbusIOException:
#             print(f"No Device at ID {address}")
#             device.disconnect()
#             print("")

port = "COM4"
baudrate = 9600
id = 1
parity = "N"
device_name = "WS100-19"

if device_name == "SDM54-2T":
    device = sdm_modbus.SDM54_2T(device= port, baud=baudrate, unit=id, parity=parity)
    device_type = "sdm"

elif device_name == "SDM630":
    device = sdm_modbus.SDM630(device= port, baud=baudrate, unit=id, parity=parity)
    device_type = "sdm"

elif device_name == "WS100-19":
    device = sdm_modbus.ws100.WS100_19XX(device= port, baud=baudrate, unit=id, parity=parity)
    device_type = "ws100"


if device_type == "sdm":
    print(device.read_all())

elif device_type == "ws100":
    print(device.read_all_scaled())



